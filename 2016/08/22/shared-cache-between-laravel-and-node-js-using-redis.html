<!DOCTYPE html> <html> <head> <title>Shared Cache Between Laravel and node.js Using Redis</title> <meta charset="utf-8" /> <meta http-equiv="X-UA-Compatible" content="IE=edge"> <meta name="viewport" content="width=device-width, initial-scale=1" /> <meta name="description" content="Good source for web development tutorial and technology article." /> <meta property="og:type" content="article" /> <meta property="og:site_name" content="ZeekLab" /> <meta property="og:title" content="Shared Cache Between Laravel and node.js Using Redis" /> <meta property="og:description" content="Good source for web development tutorial and technology article." /> <meta property="og:url" content="http://localhost:4000/2016/08/22/shared-cache-between-laravel-and-node-js-using-redis.html" /> <meta property="og:image" content="http://localhost:4000/images/header-laravel.png" /> <meta name="twitter:card" content="summary" /> <meta name="twitter:title" content="Shared Cache Between Laravel and node.js Using Redis" /> <meta name="twitter:description" content="Good source for web development tutorial and technology article." /> <meta name="twitter:url" content="http://localhost:4000/2016/08/22/shared-cache-between-laravel-and-node-js-using-redis.html" /> <meta name="twitter:image" content="http://localhost:4000/images/header-laravel.png" /> <meta name="twitter:site" content="@krisanalfa" /> <link rel="alternate" href="/feed.xml" type="application/rss+xml" title="Shared Cache Between Laravel and node.js Using Redis" /> <link rel="canonical" href="/2016/08/22/shared-cache-between-laravel-and-node-js-using-redis.html" /> <link rel="stylesheet" href="/assets/styles.css" /> <!--[if lt IE 9]> <script src="https://html5shiv.googlecode.com/svn/trunk/html5.js"></script> <![endif]--> <script> (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){ (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o), m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m) })(window,document,'script','//www.google-analytics.com/analytics.js','ga'); ga('create', 'UA-78621838-1', 'auto'); ga('send', 'pageview'); </script> </head> <body> <header class="animated fadeInDownBig"> <a href="/" title="Back to Homepage" class="logo">ZeekLab Blog</a> <button class="toggle">Menu</button> <nav> <ul> <li><a href="/" title="Home">Home</a></li> <li><a href="/2016/06/01/funny-developer-comments.html" title="Funny Developer Comments">Funny Developer Comments</a></li> <li><a href="/2016/08/11/debugging-happily-in-yii2.html" title="Debugging Happily in Yii2">Debugging Happily in Yii2</a></li> <li><a href="/2016/08/22/shared-cache-between-laravel-and-node-js-using-redis.html" title="Shared Cache Between Laravel and node.js Using Redis">Shared Cache Between Laravel and node.js Using Redis</a></li> </ul> </nav> </header> <section class="content"> <article> <header class="gradient-1" data-animation="fadeInDownBig"> <div class="overlay" style="background-image: url(/images/header-laravel.png);" data-parallax="9"></div> <div class="excerpt"> <span class="title">6 minutes</span> <h1><a href="/2016/08/22/shared-cache-between-laravel-and-node-js-using-redis.html" title="Shared Cache Between Laravel and node.js Using Redis">Shared Cache Between Laravel and node.js Using Redis</a></h1> <p>Cache Sharing Between Laravel and node.js Using Redis</p> <span class="meta">Published <b>Aug 22, 2016</b></span> </div> <a href="#" title="Scroll" class="scroll">Scroll</a> </header> <div class="body" data-animation="fadeInUp"> <p>Sometimes you have two application that share it’s cache. That’s pretty easy if both of them using same language. But how if one is using PHP (Laravel) and the other is using node.js? This article will guide you to make your Laravel application shares it’s cache to node.js application.</p> <h2 id="installation-and-configuration">Installation and Configuration</h2> <p>First, you have to configure your Laravel application to use Redis as it’s cache storage. In your <code class="highlighter-rouge">config/cache.php</code> file, adjust your cache storage like this:</p> <div class="language-php highlighter-rouge"><pre class="highlight"><code><span class="cp">&lt;?php</span>

<span class="k">return</span> <span class="p">[</span>

    <span class="cm">/*
    |--------------------------------------------------------------------------
    | Default Cache Store
    |--------------------------------------------------------------------------
    |
    | This option controls the default cache connection that gets used while
    | using this caching library. This connection is used when another is
    | not explicitly specified when executing a given caching function.
    |
    | Supported: "apc", "array", "database", "file", "memcached", "redis"
    |
    */</span>

    <span class="s1">'default'</span> <span class="o">=&gt;</span> <span class="nx">env</span><span class="p">(</span><span class="s1">'CACHE_DRIVER'</span><span class="p">,</span> <span class="s1">'redis'</span><span class="p">),</span>

    <span class="c1">// [... OMITTED ...]
</span></code></pre></div> <p>Or, change it from your <code class="highlighter-rouge">.env</code> file:</p> <div class="highlighter-rouge"><pre class="highlight"><code>CACHE_DRIVER=redis
</code></pre></div> <p>Next, install <code class="highlighter-rouge">predis/predis</code> package to use Redis with Laravel:</p> <div class="highlighter-rouge"><pre class="highlight"><code>composer require "predis/predis:~1.0"
</code></pre></div> <blockquote> <p><strong>Notes</strong>: You also have to install <code class="highlighter-rouge">redis</code> extension for PHP firstly. See more <a href="https://pecl.php.net/package/redis">here</a>.</p> </blockquote> <p>Next, to make sure that you get exact cache data from Laravel application, you need to adjust your prefix cache key. To do so, change your <code class="highlighter-rouge">config/cache.php</code> file into something like this:</p> <div class="language-php highlighter-rouge"><pre class="highlight"><code><span class="cp">&lt;?php</span>

<span class="k">return</span> <span class="p">[</span>

    <span class="c1">// [... OMMITED ...]
</span>
    <span class="cm">/*
    |--------------------------------------------------------------------------
    | Cache Key Prefix
    |--------------------------------------------------------------------------
    |
    | When utilizing a RAM based store such as APC or Memcached, there might
    | be other applications utilizing the same cache. So, we'll specify a
    | value to get prefixed to all our keys so we can avoid collisions.
    |
    */</span>

    <span class="s1">'prefix'</span> <span class="o">=&gt;</span> <span class="s1">'fus_ro_dah'</span><span class="p">,</span>

<span class="p">];</span>

</code></pre></div> <h2 id="storing-cache">Storing Cache</h2> <p>There’s no different between storing cache in Redis and storing cache in other supported Laravel cache provider (eg: memcached, file, etc). You know, kinda like this:</p> <div class="language-php highlighter-rouge"><pre class="highlight"><code><span class="cp">&lt;?php</span>

<span class="nx">Cache</span><span class="o">::</span><span class="na">put</span><span class="p">(</span><span class="s1">'fus'</span><span class="p">,</span> <span class="s1">'ro_dah'</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span> <span class="c1">// Put cache with key 'fus' and value 'ro_dah' with ttl 1 minute
</span></code></pre></div> <blockquote> <p><strong>Notes</strong>: You can learn more about storing cache in laravel <a href="https://laravel.com/docs/5.2/cache#storing-items-in-the-cache">here</a>.</p> </blockquote> <p>If you check from Redis CLI, you can see <code class="highlighter-rouge">fus</code> in there:</p> <div class="highlighter-rouge"><pre class="highlight"><code>$ redis-cli
127.0.0.1:6379&gt; KEYS fus_ro_dah:*
1) "fus_ro_dah:fus"
127.0.0.1:6379&gt;
</code></pre></div> <blockquote> <p><strong>Notes</strong>: You can learn more about Redis CLI <a href="http://redis.io/commands">here</a>.</p> </blockquote> <h2 id="getting-laravel-cache-from-nodejs-application">Getting Laravel Cache from node.js Application</h2> <p>After we store a cache, the next problem is getting the cache data from other application, such as from node.js application. Since we use Redis as our cache provider, we must require <a href="http://redis.js.org/">redis package</a> to our node.js application.</p> <div class="highlighter-rouge"><pre class="highlight"><code>npm install redis --save
</code></pre></div> <p>To get Redis cache from Laravel application, tell node.js the Laravel’s <code class="highlighter-rouge">cache_prefix</code> value, in this case it’s <code class="highlighter-rouge">fus_ro_dah</code>. For example, I create an <code class="highlighter-rouge">index.php</code> file like this:</p> <div class="language-js highlighter-rouge"><pre class="highlight"><code><span class="kd">var</span> <span class="nx">redisClient</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">'redis'</span><span class="p">).</span><span class="nx">createClient</span><span class="p">();</span>

<span class="nx">redisClient</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">'fus_ro_dah:fus'</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">err</span><span class="p">,</span> <span class="nx">reply</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">reply</span><span class="p">);</span> <span class="c1">// Output s:6:"ro_dah";</span>
<span class="p">});</span>
</code></pre></div> <p>You may notice that, the reply from Redis is an PHP encoded value:</p> <div class="highlighter-rouge"><pre class="highlight"><code>$ node index.js
s:6:"ro_dah";
$
</code></pre></div> <p>To make this reply is usable by node.js application, you may replace some string in it:</p> <div class="language-js highlighter-rouge"><pre class="highlight"><code><span class="kd">var</span> <span class="nx">redisClient</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">'redis'</span><span class="p">).</span><span class="nx">createClient</span><span class="p">();</span>

<span class="nx">redisClient</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">'fus_ro_dah:fus'</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">err</span><span class="p">,</span> <span class="nx">reply</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">reply</span> <span class="o">=</span> <span class="p">(</span><span class="nx">reply</span> <span class="o">!==</span> <span class="kc">null</span><span class="p">)</span>
    <span class="p">?</span> <span class="nx">reply</span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="sr">/^s:</span><span class="se">[</span><span class="sr">0-9</span><span class="se">]</span><span class="sr">*.:"/</span><span class="p">,</span> <span class="s1">''</span><span class="p">).</span><span class="nx">replace</span><span class="p">(</span><span class="sr">/";$/</span><span class="p">,</span> <span class="s1">''</span><span class="p">)</span>
    <span class="p">:</span> <span class="nx">reply</span><span class="p">;</span>

  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">reply</span><span class="p">);</span> <span class="c1">// Output "ro_dah"</span>
<span class="p">});</span>
</code></pre></div> <h2 id="storing-json-file-to-cache-and-retrive-its-value-using-nodejs">Storing JSON file to Cache and Retrive It’s Value Using node.js</h2> <p>In some cases, we need to store our database result to database and we need it on our node.js application. If you uses the code above to strip PHP encoded string, then there’s no need for you to change your code:</p> <div class="language-php highlighter-rouge"><pre class="highlight"><code><span class="cp">&lt;?php</span>

<span class="nx">Cache</span><span class="o">::</span><span class="na">put</span><span class="p">(</span><span class="s1">'fus'</span><span class="p">,</span> <span class="nb">json_encode</span><span class="p">([</span><span class="s1">'ro'</span> <span class="o">=&gt;</span> <span class="s1">'dah'</span><span class="p">]),</span> <span class="mi">1</span><span class="p">);</span> <span class="c1">// Example only
</span></code></pre></div> <p>With this script:</p> <div class="language-js highlighter-rouge"><pre class="highlight"><code><span class="kd">var</span> <span class="nx">redisClient</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">'redis'</span><span class="p">).</span><span class="nx">createClient</span><span class="p">();</span>

<span class="nx">redisClient</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">'fus_ro_dah:fus'</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">err</span><span class="p">,</span> <span class="nx">reply</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">reply</span> <span class="o">=</span> <span class="p">(</span><span class="nx">reply</span> <span class="o">!==</span> <span class="kc">null</span><span class="p">)</span>
    <span class="p">?</span> <span class="nx">reply</span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="sr">/^s:</span><span class="se">[</span><span class="sr">0-9</span><span class="se">]</span><span class="sr">*.:"/</span><span class="p">,</span> <span class="s1">''</span><span class="p">).</span><span class="nx">replace</span><span class="p">(</span><span class="sr">/";$/</span><span class="p">,</span> <span class="s1">''</span><span class="p">)</span>
    <span class="p">:</span> <span class="nx">reply</span><span class="p">;</span>

  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">reply</span><span class="p">);</span>
<span class="p">});</span>
</code></pre></div> <p>The output will be:</p> <div class="highlighter-rouge"><pre class="highlight"><code>$ node index.js
{"ro":"dah"}
$
</code></pre></div> <p>Or, if you want to get a JSON value, you can use <code class="highlighter-rouge">JSON.parse</code> method:</p> <div class="language-js highlighter-rouge"><pre class="highlight"><code><span class="kd">var</span> <span class="nx">redisClient</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">'redis'</span><span class="p">).</span><span class="nx">createClient</span><span class="p">();</span>

<span class="nx">redisClient</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">'fus_ro_dah:fus'</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">err</span><span class="p">,</span> <span class="nx">reply</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">reply</span> <span class="o">=</span> <span class="p">(</span><span class="nx">reply</span> <span class="o">!==</span> <span class="kc">null</span><span class="p">)</span>
    <span class="p">?</span> <span class="nx">JSON</span><span class="p">.</span><span class="nx">parse</span><span class="p">(</span><span class="nx">reply</span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="sr">/^s:</span><span class="se">[</span><span class="sr">0-9</span><span class="se">]</span><span class="sr">*.:"/</span><span class="p">,</span> <span class="s1">''</span><span class="p">).</span><span class="nx">replace</span><span class="p">(</span><span class="sr">/";$/</span><span class="p">,</span> <span class="s1">''</span><span class="p">))</span>
    <span class="p">:</span> <span class="nx">reply</span><span class="p">;</span>

  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">reply</span><span class="p">);</span>
<span class="p">});</span>
</code></pre></div> <p>The output is:</p> <div class="highlighter-rouge"><pre class="highlight"><code>$ node index.js
{ ro: 'dah' }
$
</code></pre></div> <h2 id="conclusion">Conclusion</h2> <p>If you build two applications that utilize same database, you can reduce database transaction by using cache. But sometimes, these two applications built with different language. In this case, you need a cache provider which can be used for many programming languages, Redis is one of them. Laravel and node.js is a good example to achieve this. After you read this article, you may implement this idea to your project, so you can reduce the database transaction, make your application faster, and of course without losing data consistency. If you have another idea or trouble in implementing this idea, let me know in comment below. Happy code!</p> </div> <footer> <div class="meta"> <div class="author" data-animation="fadeInUp"> <span class="title">Written by</span> <h4>Krisan Alfa Timur</h4> <p>I'm a expert Web Developer who joins the Open Source realm as a Lumen evangelist.</p> <ul> <li><a href="https://twitter.com/krisanalfa" title="Twitter" class="icon twitter">Twitter</a></li> <li><a href="https://facebook.com/KrisanAlfa.T" title="Facebook" class="icon facebook">Facebook</a></li> <li><a href="https://plus.google.com/+KrisanAlfaTimur" title="Google" class="icon google">Google</a></li> <li><a href="https://www.linkedin.com/in/krisanalfa" title="LinkedIn" class="icon linkedin">LinkedIn</a></li> <li><a href="https://pinterest.com/krisanalfa" title="Pinterest" class="icon pinterest">Pinterest</a></li> <li><a href="https://flickr.com/krisanalfa" title="Flickr" class="icon flickr">Flickr</a></li> </ul> </div> <div class="share" data-animation="fadeInUp"> <span class="title">Share</span> <ul> <li><a href="https://twitter.com/home?status=Good%20source%20for%20web%20development%20tutorial%20and%20technology%20article.%20http://localhost:4000/2016/08/22/shared-cache-between-laravel-and-node-js-using-redis.html" title="Tweet" class="icon twitter">Tweet</a></li> <li><a href="https://www.facebook.com/sharer/sharer.php?u=http://localhost:4000/2016/08/22/shared-cache-between-laravel-and-node-js-using-redis.html" title="Like" class="icon facebook">Like</a></li> <li><a href="https://plus.google.com/share?url=http://localhost:4000/2016/08/22/shared-cache-between-laravel-and-node-js-using-redis.html" title="+1" class="icon google">+1</a></li> </ul> </div> </div> <div class="comments" data-animation="fadeInUp"> <span class="title">Comments</span> <div id="disqus_thread"></div> <script type="text/javascript"> var disqus_shortname = 'krisanalfa'; (function() { var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true; dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js'; (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq); })(); </script> <noscript> Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a> </noscript> </div> <div class="pagination" data-animation="fadeInUp"> <a href="/2016/08/11/debugging-happily-in-yii2.html" title="View Older Posts" class="button older">Older</a> </div> </footer> </article> </section> <section class="teaser gradient-1" data-animation="fadeInUp"> <div class="excerpt"> <span class="title">7 minutes</span> <h1><a href="/2016/08/11/debugging-happily-in-yii2.html" title="Debugging Happily in Yii2">Debugging Happily in Yii2</a></h1> <p>Variable Dumping in Yii2 has never been so easy until you read this</p> <span class="meta">Published <b>Aug 11, 2016</b> in <b></b></span> </div> </section> <footer data-animation="fadeInUp"> <div class="copyright"> <b>Copyright 2016 Krisan Alfa Timur.</b> All Rights Reserved. <a href="mailto:krisan47@gmail.com" title="Send E-Mail">Contact</a> <a href="/feed.xml" title="Subscribe to Feed">RSS</a> </div> </footer> <script src="/assets/jquery-2.2.3.min.js"></script> <script src="/assets/viewportchecker.js"></script> <script src="/assets/scripts.js"></script> </body> </html>
